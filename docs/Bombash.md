# Generating gitBOM docs with Bombash

Do the following to generate gitBOM docs for the HelloWorld program with Bombash.

    $ git clone URL-of-this-git-repo bomsh
    $ cd bomsh
    $ cp scripts/bomsh_hook.py /tmp
    $ BOMSH= bin/bombash
    $ cd src
    $ make
    $ exit
    $ ls -tl /tmp/bomdir
    $ cat /tmp/bomsh_hook_jsonfile

All the gitBOM documents have been automatically generated by Bomsh/Bomtrace,
which contain the C header dependencies for the compiled binary files.
The generated ELF binary files are embeded with the .bom ELF section,
and the generated archive files have the additional .bom archive entry, containing the gitBOM identifier.
Here is the file content of /tmp/bomsh_hook_jsonfile and the /tmp/bomdir directory for HelloWorld:

```
[yonhan@rtp-gpu-02 src]$ more /tmp/bomdir/*
::::::::::::::
/tmp/bomdir/576e4e24b6af4311b4c51816fea2a21b1f152dbf
::::::::::::::
blob af4f09c6bbd7813b308541ae1659e7087d0de194 bom 5e1750281326e9fe14f29adc0198fc24cc8964c6
::::::::::::::
/tmp/bomdir/5e1750281326e9fe14f29adc0198fc24cc8964c6
::::::::::::::
blob 06a6891154fff74e1ddb6245f4a0467b09c617c5
blob 06dd79bc831bb06a6267a36ad2d62beccd7900b2
blob 1be90e6fab4ab9b7dd3b27cea5bb1fe29acc0204
blob 1d8a4e28d1b62a2bfeba837fe18422cd106e6ddf
blob 28488e0b05954ccf87c779f5f9258987e4d68ac5
blob 29039dc7dd32210e38e949fcf483ec8ce6f7a054
blob 31b96a7e5e17f8da4cb8e6262869f643eddbd477
blob 359f94945346c9eb4f92d1551e5e1a6d63a63dfb
blob 3f6fe3cc8563b49311327647fad53eb18d94da2c
blob 477c8e4931c0d7191187acb42f0ed4255e3619aa
blob 4f725e95ffa2663083b66a557b12751261cbcf05
blob 5bed0a499605a3a26d55443f3c8b7e67de152f74
blob 64f344c6e7897491c7c7430f52ad06c61fa85dad
blob 70a1ba017357d3111cc510e73b269541ca2aaf09
blob 70f652bca14d65c1de5a21669e7c0ffb8ecfe5ea
blob 739e08610d54f341cf14247ec38f254e1520e5b1
blob b4a429b83c345681b269bdee0785363f3d2c1f3c
blob bb04576651b9097b3027e4299cc30c88f334535f
blob c2ab78a2d4c20711295a501c61dd038bfa029934
blob e4c73fd23a271b0b452cece0212ff244d2b55d48
blob e6f7481a19cbc7857dbbfebef5adbeeaf80a70b8
blob f2682632090ba3e7f2caa1736394cbb235ceab0c
::::::::::::::
/tmp/bomdir/bomsh_gitbom_doc_mapping
::::::::::::::
{
    "1fcb431b32c201c6aaeeb0273153d146e225e52d": "576e4e24b6af4311b4c51816fea2a21b1f152dbf",
    "af4f09c6bbd7813b308541ae1659e7087d0de194": "5e1750281326e9fe14f29adc0198fc24cc8964c6"
}
[yonhan@rtp-gpu-02 src]$ readelf -x .bom /tmp/bomdir/with_bom_files/1fcb431b32c201c6aaeeb0273153d146e225e52d-with_bom-hello

Hex dump of section '.bom':
  0x00000000 576e4e24 b6af4311 b4c51816 fea2a21b WnN$..C.........
  0x00000010 1f152dbf                            ..-.

[yonhan@rtp-gpu-02 src]$ cat /tmp/bomsh_hook_jsonfile
{
    "06a6891154fff74e1ddb6245f4a0467b09c617c5": {
        "file_path": "/usr/include/bits/types/__fpos64_t.h"
    },
    "06dd79bc831bb06a6267a36ad2d62beccd7900b2": {
        "file_path": "/usr/include/bits/types/__FILE.h"
    },
    "1be90e6fab4ab9b7dd3b27cea5bb1fe29acc0204": {
        "file_path": "/usr/include/bits/stdio_lim.h"
    },
    "1d8a4e28d1b62a2bfeba837fe18422cd106e6ddf": {
        "file_path": "/usr/include/bits/types/__mbstate_t.h"
    },
    "1fcb431b32c201c6aaeeb0273153d146e225e52d": {
        "build_cmd": "gcc -o hello hello.o",
        "file_path": "/data/yonhan/some-git-dir/bomsh-gitdir/src/hello",
        "hash_tree": [
            "af4f09c6bbd7813b308541ae1659e7087d0de194"
        ]
    },
    "28488e0b05954ccf87c779f5f9258987e4d68ac5": {
        "file_path": "/usr/include/bits/long-double.h"
    },
    "29039dc7dd32210e38e949fcf483ec8ce6f7a054": {
        "file_path": "/data/yonhan/some-git-dir/bomsh-gitdir/src/hello.c"
    },
    "31b96a7e5e17f8da4cb8e6262869f643eddbd477": {
        "file_path": "/usr/lib/gcc/x86_64-redhat-linux/8/include/stddef.h"
    },
    "359f94945346c9eb4f92d1551e5e1a6d63a63dfb": {
        "file_path": "/usr/include/bits/types/struct_FILE.h"
    },
    "3f6fe3cc8563b49311327647fad53eb18d94da2c": {
        "file_path": "/usr/include/sys/cdefs.h"
    },
    "477c8e4931c0d7191187acb42f0ed4255e3619aa": {
        "file_path": "/usr/include/gnu/stubs-64.h"
    },
    "4f725e95ffa2663083b66a557b12751261cbcf05": {
        "file_path": "/usr/include/bits/sys_errlist.h"
    },
    "5bed0a499605a3a26d55443f3c8b7e67de152f74": {
        "file_path": "/usr/include/features.h"
    },
    "64f344c6e7897491c7c7430f52ad06c61fa85dad": {
        "file_path": "/usr/include/bits/types.h"
    },
    "70a1ba017357d3111cc510e73b269541ca2aaf09": {
        "file_path": "/usr/include/gnu/stubs.h"
    },
    "70f652bca14d65c1de5a21669e7c0ffb8ecfe5ea": {
        "file_path": "/usr/include/bits/wordsize.h"
    },
    "739e08610d54f341cf14247ec38f254e1520e5b1": {
        "file_path": "/usr/include/stdio.h"
    },
    "af4f09c6bbd7813b308541ae1659e7087d0de194": {
        "build_cmd": "gcc -c -o hello.o hello.c",
        "file_path": "/data/yonhan/some-git-dir/bomsh-gitdir/src/hello.o",
        "hash_tree": [
            "739e08610d54f341cf14247ec38f254e1520e5b1",
            "5bed0a499605a3a26d55443f3c8b7e67de152f74",
            "e6f7481a19cbc7857dbbfebef5adbeeaf80a70b8",
            "06a6891154fff74e1ddb6245f4a0467b09c617c5",
            "31b96a7e5e17f8da4cb8e6262869f643eddbd477",
            "e4c73fd23a271b0b452cece0212ff244d2b55d48",
            "b4a429b83c345681b269bdee0785363f3d2c1f3c",
            "f2682632090ba3e7f2caa1736394cbb235ceab0c",
            "3f6fe3cc8563b49311327647fad53eb18d94da2c",
            "359f94945346c9eb4f92d1551e5e1a6d63a63dfb",
            "4f725e95ffa2663083b66a557b12751261cbcf05",
            "29039dc7dd32210e38e949fcf483ec8ce6f7a054",
            "28488e0b05954ccf87c779f5f9258987e4d68ac5",
            "64f344c6e7897491c7c7430f52ad06c61fa85dad",
            "1d8a4e28d1b62a2bfeba837fe18422cd106e6ddf",
            "70a1ba017357d3111cc510e73b269541ca2aaf09",
            "70f652bca14d65c1de5a21669e7c0ffb8ecfe5ea",
            "477c8e4931c0d7191187acb42f0ed4255e3619aa",
            "bb04576651b9097b3027e4299cc30c88f334535f",
            "c2ab78a2d4c20711295a501c61dd038bfa029934",
            "1be90e6fab4ab9b7dd3b27cea5bb1fe29acc0204",
            "06dd79bc831bb06a6267a36ad2d62beccd7900b2"
        ]
    },
    "b4a429b83c345681b269bdee0785363f3d2c1f3c": {
        "file_path": "/usr/include/bits/libc-header-start.h"
    },
    "bb04576651b9097b3027e4299cc30c88f334535f": {
        "file_path": "/usr/include/bits/types/__fpos_t.h"
    },
    "c2ab78a2d4c20711295a501c61dd038bfa029934": {
        "file_path": "/usr/include/stdc-predef.h"
    },
    "e4c73fd23a271b0b452cece0212ff244d2b55d48": {
        "file_path": "/usr/lib/gcc/x86_64-redhat-linux/8/include/stdarg.h"
    },
    "e6f7481a19cbc7857dbbfebef5adbeeaf80a70b8": {
        "file_path": "/usr/include/bits/typesizes.h"
    },
    "f2682632090ba3e7f2caa1736394cbb235ceab0c": {
        "file_path": "/usr/include/bits/types/FILE.h"
    }
}
[yonhan@rtp-gpu-02 src]$
```

If you need to generate gitBOM docs for another software like OpenOSC,

    $ git clone URL-of-this-git-repo bomsh
    $ rm -rf /tmp/bomdir; rm /tmp/bomsh_hook_*; cp bomsh/scripts/bomsh_hook.py /tmp
    $ git clone https://github.com/cisco/OpenOSC.git
    $ cd OpenOSC
    $ autoreconf -vfi ; ./configure CC=clang
    $ BOMSH= ../bomsh/bin/bombash
    $ make
    $ exit
    $ ls -tl /tmp/bomdir
    $ cat /tmp/bomsh_hook_jsonfile

Here is the new libopenosc.a archive file with embedded .bom archive entry:

```
root@0b3023697a46:/home/OpenOSC# git hash-object src/.libs/libopenosc.a
6bc61598a60ea60fcfb51b76bc47b45ee8b6946c
root@0b3023697a46:/home/OpenOSC# ar -tv src/.libs/libopenosc.a
rw-r--r-- 0/0  27408 Jan  1 00:00 1970 libopenosc_la-openosc_map.o
rw-r--r-- 0/0  11312 Jan  1 00:00 1970 libopenosc_la-openosc_support.o
rw-r--r-- 0/0   2784 Jan  1 00:00 1970 libopenosc_la-openosc_package_info.o
rw-r--r-- 0/0 104544 Jan  1 00:00 1970 libopenosc_la-openosc_fortify_map.o
root@0b3023697a46:/home/OpenOSC# ar -tv /tmp/bomdir/with_bom_files/6bc61598a60ea60fcfb51b76bc47b45ee8b6946c-with_bom-libopenosc.a
rw-r--r-- 0/0  27408 Jan  1 00:00 1970 libopenosc_la-openosc_map.o
rw-r--r-- 0/0  11312 Jan  1 00:00 1970 libopenosc_la-openosc_support.o
rw-r--r-- 0/0   2784 Jan  1 00:00 1970 libopenosc_la-openosc_package_info.o
rw-r--r-- 0/0 104544 Jan  1 00:00 1970 libopenosc_la-openosc_fortify_map.o
rw-r--r-- 0/0     20 Jan  1 00:00 1970 .bom
root@0b3023697a46:/home/OpenOSC# ar -x /tmp/bomdir/with_bom_files/6bc61598a60ea60fcfb51b76bc47b45ee8b6946c-with_bom-libopenosc.a .bom
root@0b3023697a46:/home/OpenOSC# hexdump -C .bom
00000000  41 d3 3f 44 eb 60 cb e6  d2 76 0f 7f db a5 36 c2  |A.?D.`...v....6.|
00000010  f3 62 a3 8e                                       |.b..|
00000014
root@0b3023697a46:/home/OpenOSC# cat /tmp/bomdir/41d33f44eb60cbe6d2760f7fdba536c2f362a38e
blob 438bf647db266e2b7d71557436beda2ca21afb27 bom 54e7d1011d2dbc7d786b4e07bd9216c89ae08d16
blob 88eea30ff5cb11cc2c54c36ecbb7d350723d1063 bom c7d70100720bc7f329e8994e48d3e88611569861
blob b4661cd71c95124d8da0bfba6b97d1d1c313750b bom 1297782f73770700c5eea7fb66d07c6f1eeeabe9
blob b655de6691f64b0ecb445c68ff98815204c9f521 bom 81e3016686ed2c4330a525254170cdc3e75be17c
root@0b3023697a46:/home/OpenOSC#
```

If you need to generate gitBOM docs for another software like OpenSSL,

    $ git clone URL-of-this-git-repo bomsh
    $ rm -rf /tmp/bomdir; rm /tmp/bomsh_hook_*; cp bomsh/scripts/bomsh_hook.py /tmp
    $ git clone https://github.com/openssl/openssl.git
    $ cd openssl
    $ ./Configure
    $ BOMSH= ../bomsh/bin/bombash
    $ make
    $ exit
    $ ls -tl /tmp/bomdir
    $ cat /tmp/bomsh_hook_jsonfile

The bomsh_hook.py script is a Python script, make sure that you have Python3 installed.
This script is invoked for each recorded shell command under the Bombash shell or with Bomtrace.
You can play with the bomsh_hook.py script and observe the output changes.
